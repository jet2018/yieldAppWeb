{% extends 'basic.html' %} {% block content %}
<div class="login-box">
    <div class="login-logo">
        <a href="{% url 'posts:index' %}"><b>Yield</b>Up</a>
    </div>
    <!-- /.login-logo -->
    <div class="card">
        <div class="card-body login-card-body">
            <p class="login-box-msg">You forgot your password? Here you can easily retrieve a new password.</p>
            <div class="alert d-none" id="message"></div>

            <form id="ignite_reset" method="post" data-redirect="{% url 'profile:enter_code' %}" action="{% url 'profile:reset_password_with_token' %}">
                {% csrf_token %}
                <div class="input-group mb-3">
                    <input type="email" name="email" required class="form-control" placeholder="Email">
                    <div class="input-group-append">
                        <div class="input-group-text">
                            <span class="fas fa-envelope"></span>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-12">
                        <button type="submit" class="btn btn-warning btn-block" id="btn_submit">Request new password</button>
                    </div>
                    <!-- /.col -->
                </div>
            </form>

            <p class="mt-3 mb-1">
                <a href="{% url 'posts:login' %}">Login</a>
            </p>
            <p class="mb-0">
                <a href="{% url 'posts:register' %}" class="text-center">Register a new membership</a>
            </p>
        </div>
        <!-- /.login-card-body -->
    </div>
</div>
{% endblock content %} {% block script %}
<script>
    $('#ignite_reset').submit(function(e) {
        e.preventDefault()
        data = $(this).serialize()
        url = $(this).attr("action")
        $.ajax({
            url: url,
            data: data,
            type: 'POST',
            beforeSend: function() {
                $('#btn_submit').attr('disabled', true)
                $('#btn_submit').html('<i class="fa fa-spinner fa-spin"></i> Sending...')
            },
            success: function(res) {
                let bg = "success"
                if (!res.status) {
                    bg = "danger"
                }
                $("#message").text(res.message).removeClass('d-none').addClass("alert-" + bg)
                setTimeout(function() {
                    $("#message").fadeOut('slow').addClass("d-none").removeClass("alert-" + bg)
                    if (res.status) {
                        window.location.href = $('#ignite_reset').data("redirect")
                    }
                }, 4000)
            },
            complete: () => {
                $('#btn_submit').attr('disabled', false)
                $('#btn_submit').html('Request new password')
            }


        })

    })
</script>
{% endblock script %}